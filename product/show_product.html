<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
	<meta http-equiv="X-UA-Compatible" content="IE=edge">
	<title>product</title>
	<script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.2.0/react.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/react/15.2.0/react-dom.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/babel-core/5.6.16/browser.js"></script>
</head>
<body>
	<div id="container"></div>

	<script type="text/babel">
	/* --FilterableProductTable
			--SearchBar
			--ProductTable
				--ProductCategoryRow
				--ProductRow
	*/

	//ProductRow
	var ProductRow = React.createClass({
		render:function(){
			var name = this.props.product.stocked ? 
				this.props.product.name : 
				<span style={{color:"red"}}>{this.props.product.name}</span>;
			return (
				<tr>
					<td>{name}</td>
					<td>{this.props.product.price}</td>
				</tr>
			);
		}
	});

	//ProductCategoryRow
	var ProductCategoryRow = React.createClass({
		render:function(){
			return (
				<tr>
					<th colSpan="2">{this.props.category}</th>
				</tr>
			);
		}
	});

	//ProductTable
	var ProductTable = React.createClass({
		render:function(){
			var rows = [];
			var lastCategory = null;
			this.props.products.forEach(function(product){
				if(product.name.indexOf(this.props.search) === -1 || (!product.stocked && 
				this.props.inStockedOnly)){
					return;
				}
				if(product.category !== lastCategory){
					rows.push(<ProductCategoryRow category={product.category} key={product.category} />);
				}
				rows.push(<ProductRow product={product} key={product.name} />);
				lastCategory = product.category;
			}.bind(this));
			return (
				<table>
					<thead>
						<tr>
							<th>Name</th>
							<th>Price</th>
						</tr>
					</thead>
					<tbody>
						{rows}
					</tbody>
				</table>
			);
		}
	});

	//SearchBar
	var SearchBar = React.createClass({
		handleChange:function(){
			var searchInput = this.refs.searchInput.value;
			var checked = this.refs.checkedValue.checked;
			this.props.onSearchChange(searchInput,checked);
		},
		render:function(){
			return (
				<form>
					<input type="text" onChange={this.handleChange} ref="searchInput" value={this.props.search} placeholder="search something here" />
					<p>
					<input type="checkbox" onChange={this.handleChange} ref="checkedValue" checked={this.props.inStockedOnly} />Only show products in stock</p>
				</form>
			);
		}
	});

	//FilterableProductTable
	var FilterableProductTable = React.createClass({
		getInitialState:function(){
			return {
				search:"",
				inStockedOnly:false
			};
		},
		handleSearchChange:function(search,inStockedOnly){
			this.setState({
				search:search,
				inStockedOnly:inStockedOnly
			});
		},
		render:function(){
			return (
				<div>
					<SearchBar search=
	</script>
</body>
</html>